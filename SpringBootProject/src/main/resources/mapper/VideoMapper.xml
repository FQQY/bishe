<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.springbootproject.dao.VideoMapper">

  <resultMap id="BaseResultMap" type="com.example.springbootproject.entity.Video">
    <id column="work_id" jdbcType="VARCHAR" property="workId" />
    <result column="usr_id" jdbcType="VARCHAR" property="usrId" />
    <result column="cat_id" jdbcType="INTEGER" property="catId" />
    <result column="work_src" jdbcType="VARCHAR" property="workSrc" />
    <result column="work_content" jdbcType="LONGVARCHAR" property="workContent" />
    <result column="work_duration" jdbcType="VARCHAR" property="workDuration" />
    <result column="work_upload_time" jdbcType="TIMESTAMP" property="workUploadTime" />
    <result column="pass_flag" jdbcType="CHAR" property="passFlag" />
    <result column="del_flag" jdbcType="CHAR" property="delFlag" />
    <result column="work_title" jdbcType="VARCHAR" property="workTitle" />
    <result column="work_photo" jdbcType="VARCHAR" property="workPhoto" />
  </resultMap>

  <resultMap id="VideoDTOResultMap" extends="BaseResultMap" type="com.example.springbootproject.entity.VideoDTO">
    <association property="user" javaType="com.example.springbootproject.entity.User">
      <id column="usr_id" jdbcType="VARCHAR" property="usrId" />
      <result column="usr_name" jdbcType="VARCHAR" property="usrName" />
      <result column="usr_password" jdbcType="VARCHAR" property="usrPassword" />
      <result column="usr_sex" jdbcType="INTEGER" property="usrSex" />
      <result column="usr_email" jdbcType="VARCHAR" property="usrEmail" />
      <result column="usr_register_time" jdbcType="TIMESTAMP" property="usrRegisterTime" />
      <result column="ban_flag" jdbcType="CHAR" property="banFlag" />
      <result column="del_flag" jdbcType="CHAR" property="delFlag" />
      <result column="usr_authority" jdbcType="CHAR" property="usrAuthority" />
    </association>
    <association property="category" javaType="com.example.springbootproject.entity.Category">
      <id column="cat_id" jdbcType="INTEGER" property="catId" />
      <result column="cat_name" jdbcType="VARCHAR" property="catName" />
      <result column="del_flag" jdbcType="CHAR" property="delFlag" />
    </association>
  </resultMap>

  <sql id="Base_Column_List">
    work_id, usr_id, cat_id, work_src, work_duration, work_upload_time, pass_flag, del_flag,work_content,work_title,work_photo
  </sql>

  <select id="selectPassVideo" parameterType="java.lang.String" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from work
    where work_id = #{workId,jdbcType=VARCHAR}
    and work.work_src is not null
    and del_flag = 0
    and pass_flag = 1
  </select>


  <select id="selectVideosByUsrId" parameterType="java.lang.String" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from work
    where usr_id = #{usrId,jdbcType=VARCHAR}
    and work.work_src is not null
    and del_flag = 0
  </select>

  <select id="selectAllVideo" parameterType="java.lang.String"  resultMap="VideoDTOResultMap">
    select
    *
    from user join work on user.usr_id = work.usr_id
    join category on work.cat_id = category.cat_id
    <where>
      <if test="workTitle != null and workTitle.length() != 0">
        work_title like concat(concat('%',#{workTitle,jdbcType=VARCHAR}),'%')
      </if>
        and work.work_src is not null
        and work.del_flag = 0
        and work.pass_flag = 1

    </where>
  </select>

  <select id="selectVideosByCatId" parameterType="java.lang.Integer" resultMap="VideoDTOResultMap">
    select
      *
    from user join work on user.usr_id = work.usr_id
              join category on work.cat_id = category.cat_id
    <where>
      and work.cat_id = #{catId,jdbcType=INTEGER}
      and work.work_src is not null
      and work.del_flag = 0
      and work.pass_flag = 1
    </where>
  </select>

  <insert id="insertSelective" parameterType="com.example.springbootproject.entity.Video">
    insert into work
    <trim prefix="(" suffix=")" suffixOverrides=",">
        work_id,
        usr_id,
      <if test="catId != null">
        cat_id,
      </if>
      <if test="workSrc != null">
        work_src,
      </if>
      <if test="workDuration != null">
        work_duration,
      </if>
        work_upload_time,
      <if test="workContent != null">
        work_content,
      </if>
      <if test="workTitle != null">
        work_title,
      </if>
      <if test="workPhoto != null">
        work_photo,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
        #{workId,jdbcType=VARCHAR},
        #{usrId,jdbcType=VARCHAR},
      <if test="catId != null">
        #{catId,jdbcType=INTEGER},
      </if>
      <if test="workSrc != null">
        #{workSrc,jdbcType=VARCHAR},
      </if>
      <if test="workDuration != null">
        #{workDuration,jdbcType=VARCHAR},
      </if>
        #{workUploadTime,jdbcType=TIMESTAMP},
      <if test="workContent != null">
        #{workContent,jdbcType=LONGVARCHAR},
      </if>
      <if test="workTitle != null">
        #{workTitle,jdbcType=VARCHAR},
      </if>
      <if test="workPhoto != null">
        #{workPhoto,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>



  <insert id="insert" parameterType="com.example.springbootproject.entity.Video">
    insert into work (work_id, usr_id, cat_id,
                      work_src, work_duration, work_upload_time,
                      pass_flag, del_flag, work_content
    )
    values (#{workId,jdbcType=VARCHAR}, #{usrId,jdbcType=VARCHAR}, #{catId,jdbcType=INTEGER},
            #{workSrc,jdbcType=VARCHAR}, #{workDuration,jdbcType=VARCHAR}, #{workUploadTime,jdbcType=TIMESTAMP},
            #{passFlag,jdbcType=CHAR}, #{delFlag,jdbcType=CHAR}, #{workContent,jdbcType=LONGVARCHAR}
           )
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.example.springbootproject.entity.Video">
    update work
    <set>
      <if test="usrId != null">
        usr_id = #{usrId,jdbcType=VARCHAR},
      </if>
      <if test="catId != null">
        cat_id = #{catId,jdbcType=INTEGER},
      </if>
      <if test="workSrc != null">
        work_src = #{workSrc,jdbcType=VARCHAR},
      </if>
      <if test="workDuration != null">
        work_duration = #{workDuration,jdbcType=VARCHAR},
      </if>
      <if test="workUploadTime != null">
        work_upload_time = #{workUploadTime,jdbcType=TIMESTAMP},
      </if>
      <if test="passFlag != null">
        pass_flag = #{passFlag,jdbcType=CHAR},
      </if>
      <if test="delFlag != null">
        del_flag = #{delFlag,jdbcType=CHAR},
      </if>
      <if test="workContent != null">
        work_content = #{workContent,jdbcType=LONGVARCHAR},
      </if>
    </set>
    where work_id = #{workId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKeyWithBLOBs" parameterType="com.example.springbootproject.entity.Video">
    update work
    set usr_id = #{usrId,jdbcType=VARCHAR},
      cat_id = #{catId,jdbcType=INTEGER},
      work_src = #{workSrc,jdbcType=VARCHAR},
      work_duration = #{workDuration,jdbcType=VARCHAR},
      work_upload_time = #{workUploadTime,jdbcType=TIMESTAMP},
      pass_flag = #{passFlag,jdbcType=CHAR},
      del_flag = #{delFlag,jdbcType=CHAR},
      work_content = #{workContent,jdbcType=LONGVARCHAR}
    where work_id = #{workId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.example.springbootproject.entity.Video">
    update work
    set del_flag = 1
    where work_id = #{workId,jdbcType=VARCHAR}
    and usr_id = #{usrId,jdbcType=VARCHAR}
  </update>
</mapper>